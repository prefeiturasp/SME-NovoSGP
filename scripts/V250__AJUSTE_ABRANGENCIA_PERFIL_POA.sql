insert into abrangencia (usuario_id, dre_id, ue_id, turma_id, perfil, historico, dt_fim_vinculo) select (select id from usuario where login = '6339239'), NULL, NULL, (select id from turma where turma_id = '2125517'), '3fe1e074-37d6-e911-abd6-f81654fe895d', false, NULL where exists (select 1 from usuario where login = '6339239') and not exists (select 1 from abrangencia a inner join usuario u on a.usuario_id = u.id inner join turma t on a.turma_id = t.id where not a.historico and u.login = '6339239' and t.turma_id = '2125517');
insert into abrangencia (usuario_id, dre_id, ue_id, turma_id, perfil, historico, dt_fim_vinculo) select (select id from usuario where login = '6339239'), NULL, NULL, (select id from turma where turma_id = '2125549'), '3fe1e074-37d6-e911-abd6-f81654fe895d', false, NULL where exists (select 1 from usuario where login = '6339239') and not exists (select 1 from abrangencia a inner join usuario u on a.usuario_id = u.id inner join turma t on a.turma_id = t.id where not a.historico and u.login = '6339239' and t.turma_id = '2125549');
insert into abrangencia (usuario_id, dre_id, ue_id, turma_id, perfil, historico, dt_fim_vinculo) select (select id from usuario where login = '6339239'), NULL, NULL, (select id from turma where turma_id = '2125569'), '3fe1e074-37d6-e911-abd6-f81654fe895d', false, NULL where exists (select 1 from usuario where login = '6339239') and not exists (select 1 from abrangencia a inner join usuario u on a.usuario_id = u.id inner join turma t on a.turma_id = t.id where not a.historico and u.login = '6339239' and t.turma_id = '2125569');
insert into abrangencia (usuario_id, dre_id, ue_id, turma_id, perfil, historico, dt_fim_vinculo) select (select id from usuario where login = '6339239'), NULL, NULL, (select id from turma where turma_id = '2125585'), '3fe1e074-37d6-e911-abd6-f81654fe895d', false, NULL where exists (select 1 from usuario where login = '6339239') and not exists (select 1 from abrangencia a inner join usuario u on a.usuario_id = u.id inner join turma t on a.turma_id = t.id where not a.historico and u.login = '6339239' and t.turma_id = '2125585');
insert into abrangencia (usuario_id, dre_id, ue_id, turma_id, perfil, historico, dt_fim_vinculo) select (select id from usuario where login = '6339239'), NULL, NULL, (select id from turma where turma_id = '2125591'), '3fe1e074-37d6-e911-abd6-f81654fe895d', false, NULL where exists (select 1 from usuario where login = '6339239') and not exists (select 1 from abrangencia a inner join usuario u on a.usuario_id = u.id inner join turma t on a.turma_id = t.id where not a.historico and u.login = '6339239' and t.turma_id = '2125591');
insert into abrangencia (usuario_id, dre_id, ue_id, turma_id, perfil, historico, dt_fim_vinculo) select (select id from usuario where login = '6339239'), NULL, NULL, (select id from turma where turma_id = '2125602'), '3fe1e074-37d6-e911-abd6-f81654fe895d', false, NULL where exists (select 1 from usuario where login = '6339239') and not exists (select 1 from abrangencia a inner join usuario u on a.usuario_id = u.id inner join turma t on a.turma_id = t.id where not a.historico and u.login = '6339239' and t.turma_id = '2125602');
insert into abrangencia (usuario_id, dre_id, ue_id, turma_id, perfil, historico, dt_fim_vinculo) select (select id from usuario where login = '6339239'), NULL, NULL, (select id from turma where turma_id = '2125621'), '3fe1e074-37d6-e911-abd6-f81654fe895d', false, NULL where exists (select 1 from usuario where login = '6339239') and not exists (select 1 from abrangencia a inner join usuario u on a.usuario_id = u.id inner join turma t on a.turma_id = t.id where not a.historico and u.login = '6339239' and t.turma_id = '2125621');
insert into abrangencia (usuario_id, dre_id, ue_id, turma_id, perfil, historico, dt_fim_vinculo) select (select id from usuario where login = '6339239'), NULL, NULL, (select id from turma where turma_id = '2125629'), '3fe1e074-37d6-e911-abd6-f81654fe895d', false, NULL where exists (select 1 from usuario where login = '6339239') and not exists (select 1 from abrangencia a inner join usuario u on a.usuario_id = u.id inner join turma t on a.turma_id = t.id where not a.historico and u.login = '6339239' and t.turma_id = '2125629');
insert into abrangencia (usuario_id, dre_id, ue_id, turma_id, perfil, historico, dt_fim_vinculo) select (select id from usuario where login = '6339239'), NULL, NULL, (select id from turma where turma_id = '2125671'), '3fe1e074-37d6-e911-abd6-f81654fe895d', false, NULL where exists (select 1 from usuario where login = '6339239') and not exists (select 1 from abrangencia a inner join usuario u on a.usuario_id = u.id inner join turma t on a.turma_id = t.id where not a.historico and u.login = '6339239' and t.turma_id = '2125671');
insert into abrangencia (usuario_id, dre_id, ue_id, turma_id, perfil, historico, dt_fim_vinculo) select (select id from usuario where login = '6339239'), NULL, NULL, (select id from turma where turma_id = '2125676'), '3fe1e074-37d6-e911-abd6-f81654fe895d', false, NULL where exists (select 1 from usuario where login = '6339239') and not exists (select 1 from abrangencia a inner join usuario u on a.usuario_id = u.id inner join turma t on a.turma_id = t.id where not a.historico and u.login = '6339239' and t.turma_id = '2125676');
insert into abrangencia (usuario_id, dre_id, ue_id, turma_id, perfil, historico, dt_fim_vinculo) select (select id from usuario where login = '6339239'), NULL, NULL, (select id from turma where turma_id = '2125681'), '3fe1e074-37d6-e911-abd6-f81654fe895d', false, NULL where exists (select 1 from usuario where login = '6339239') and not exists (select 1 from abrangencia a inner join usuario u on a.usuario_id = u.id inner join turma t on a.turma_id = t.id where not a.historico and u.login = '6339239' and t.turma_id = '2125681');
insert into abrangencia (usuario_id, dre_id, ue_id, turma_id, perfil, historico, dt_fim_vinculo) select (select id from usuario where login = '6339239'), NULL, NULL, (select id from turma where turma_id = '2138148'), '3fe1e074-37d6-e911-abd6-f81654fe895d', false, NULL where exists (select 1 from usuario where login = '6339239') and not exists (select 1 from abrangencia a inner join usuario u on a.usuario_id = u.id inner join turma t on a.turma_id = t.id where not a.historico and u.login = '6339239' and t.turma_id = '2138148');
insert into abrangencia (usuario_id, dre_id, ue_id, turma_id, perfil, historico, dt_fim_vinculo) select (select id from usuario where login = '6339239'), NULL, NULL, (select id from turma where turma_id = '2140846'), '3fe1e074-37d6-e911-abd6-f81654fe895d', false, NULL where exists (select 1 from usuario where login = '6339239') and not exists (select 1 from abrangencia a inner join usuario u on a.usuario_id = u.id inner join turma t on a.turma_id = t.id where not a.historico and u.login = '6339239' and t.turma_id = '2140846');
insert into abrangencia (usuario_id, dre_id, ue_id, turma_id, perfil, historico, dt_fim_vinculo) select (select id from usuario where login = '6339239'), NULL, NULL, (select id from turma where turma_id = '2140859'), '3fe1e074-37d6-e911-abd6-f81654fe895d', false, NULL where exists (select 1 from usuario where login = '6339239') and not exists (select 1 from abrangencia a inner join usuario u on a.usuario_id = u.id inner join turma t on a.turma_id = t.id where not a.historico and u.login = '6339239' and t.turma_id = '2140859');
insert into abrangencia (usuario_id, dre_id, ue_id, turma_id, perfil, historico, dt_fim_vinculo) select (select id from usuario where login = '6339239'), NULL, NULL, (select id from turma where turma_id = '2200921'), '3fe1e074-37d6-e911-abd6-f81654fe895d', false, NULL where exists (select 1 from usuario where login = '6339239') and not exists (select 1 from abrangencia a inner join usuario u on a.usuario_id = u.id inner join turma t on a.turma_id = t.id where not a.historico and u.login = '6339239' and t.turma_id = '2200921');
insert into abrangencia (usuario_id, dre_id, ue_id, turma_id, perfil, historico, dt_fim_vinculo) select (select id from usuario where login = '6339239'), NULL, NULL, (select id from turma where turma_id = '2200928'), '3fe1e074-37d6-e911-abd6-f81654fe895d', false, NULL where exists (select 1 from usuario where login = '6339239') and not exists (select 1 from abrangencia a inner join usuario u on a.usuario_id = u.id inner join turma t on a.turma_id = t.id where not a.historico and u.login = '6339239' and t.turma_id = '2200928');


insert into abrangencia (usuario_id, dre_id, ue_id, turma_id, perfil, historico, dt_fim_vinculo)
select distinct a.usuario_id,
				null::int8,
				t.ue_id,
				null::int8,
				a.perfil,
				false,
				null::date
from abrangencia a
	inner join turma t
		on a.turma_id = t.id
where perfil = '3fe1e074-37d6-e911-abd6-f81654fe895d' and
	not a.historico and
	not exists (select 1
					from abrangencia a2
				where a2.usuario_id = a.usuario_id and
					a2.ue_id = t.ue_id and
					not a2.historico);